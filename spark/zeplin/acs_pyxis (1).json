{"paragraphs":[{"text":"%spark.pyspark\nimport os\nimport urllib.request\nimport zipfile\nimport json\n","user":"anonymous","dateUpdated":"2020-06-05T07:41:36+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591189226831_-427826617","id":"20200603-130026_1672067123","dateCreated":"2020-06-03T13:00:26+0000","dateStarted":"2020-06-05T07:41:36+0000","dateFinished":"2020-06-05T07:41:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:172"},{"text":"%spark.pyspark\r\n\r\nfrom pyspark.sql import SparkSession\r\nspark = SparkSession.builder.appName('acsdata').getOrCreate()\r\nes_hadoop = urllib.request.URLopener()\r\nes_hadoop.retrieve(\"http://download.elastic.co/hadoop/elasticsearch-hadoop-6.1.1.zip\", \"es-hadoop.zip\")\r\nwith zipfile.ZipFile(\"es-hadoop.zip\",\"r\") as zip_ref:\r\n    zip_ref.extractall()\r\n    \r\nos.environ['PYSPARK_SUBMIT_ARGS'] = '--jars elasticsearch-hadoop-6.1.1/dist/elasticsearch-spark-20_2.11-6.1.1.jar pyspark-shell'","user":"anonymous","dateUpdated":"2020-06-05T07:43:15+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1591192983250_-324495777","id":"20200603-140303_2021249394","dateCreated":"2020-06-03T14:03:03+0000","dateStarted":"2020-06-05T07:43:15+0000","dateFinished":"2020-06-05T07:43:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:173"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591340372973_1842081830","id":"20200605-065932_541237539","dateCreated":"2020-06-05T06:59:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:174","text":"%spark.pyspark\r\n\r\nfrom pyspark.sql import SparkSession\r\nspark = SparkSession.builder.appName('acsdata').getOrCreate()","dateUpdated":"2020-06-05T07:44:05+0000","dateFinished":"2020-06-05T07:44:05+0000","dateStarted":"2020-06-05T07:44:05+0000","results":{"code":"SUCCESS","msg":[]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591342971746_-1336599280","id":"20200605-074251_246399432","dateCreated":"2020-06-05T07:42:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:422","text":"%spark.pyspark\r\n\r\nes_write_conf_acs = {\r\n    \"es.nodes\" : \"https://vpc-elasticsearch-polarisapps-qc-kttkced2njswnhaa2n4mbou2cq.us-east-1.es.amazonaws.com\",\r\n    \"es.port\" : \"443\",\r\n    \"es.net.ssl\": \"true\",\r\n    \"es.nodes.wan.only\": \"true\",\r\n    \"es.resource\" : \"acsdata/data\",\r\n    \"es.input.json\" : \"yes\",\r\n\t\"es.mapping.id\": \"id\"\r\n}","dateUpdated":"2020-06-05T08:02:54+0000","dateFinished":"2020-06-05T08:02:54+0000","dateStarted":"2020-06-05T08:02:54+0000","results":{"code":"SUCCESS","msg":[]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591343593234_-1642135015","id":"20200605-075313_120424338","dateCreated":"2020-06-05T07:53:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:518","text":"%spark.pyspark\r\ndf = spark.read.json('S3://271849239056-dev-datagov-stage-s3/datasource=acs/acs-pyxis/B25119')\r\ndf.printSchema()","dateUpdated":"2020-06-05T08:06:34+0000","dateFinished":"2020-06-05T08:06:45+0000","dateStarted":"2020-06-05T08:06:34+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- estimateAnnotation: string (nullable = true)\n |-- estimateValue: long (nullable = true)\n |-- geoId: string (nullable = true)\n |-- marginAnnotation: string (nullable = true)\n |-- marginOfErrorValue: long (nullable = true)\n |-- variableCode: string (nullable = true)\n |-- vintage: long (nullable = true)\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-10-66-198-209.ec2.internal:4040/jobs/job?id=9"],"interpreterSettingId":"spark"}}},{"text":"%spark.pyspark\ndef generate_Additional_Fields(geoId,vintage,variableCode):\n    zipCode=geoId.split('US')[1]\n    variableCodeType=variableCode.split('_')[1]\n    id ='{}-{}-{}'.format(zipCode,vintage,variableCode)\n    return {'id':id,'zipCode':zipCode,'variableCodeType':variableCodeType}","user":"anonymous","dateUpdated":"2020-06-05T08:07:02+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344394108_-475026584","id":"20200605-080634_1833238006","dateCreated":"2020-06-05T08:06:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:734","dateFinished":"2020-06-05T08:07:02+0000","dateStarted":"2020-06-05T08:07:02+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%spark.pyspark\ngenerate_Additional_Fields('8600000US006012018B25064_001',1,'c_c')","user":"anonymous","dateUpdated":"2020-06-05T08:07:15+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344422859_2007628208","id":"20200605-080702_2043374992","dateCreated":"2020-06-05T08:07:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:847","dateFinished":"2020-06-05T08:07:15+0000","dateStarted":"2020-06-05T08:07:15+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"{'id': '006012018B25064_001-1-c_c', 'zipCode': '006012018B25064_001', 'variableCodeType': 'c'}\n"}]}},{"text":"%spark.pyspark\ndef formatter(x):\n    additional_Fields=generate_Additional_Fields(x.geoId,x.vintage,x.variableCode)\n    id=additional_Fields['id']\n    return (id,json.dumps({\n                     'id':id,\n                      'zipCode':additional_Fields['zipCode'],\n                      'variableCodeType':additional_Fields['variableCodeType'],\n                     'estimateAnnotation':x.estimateAnnotation,\n                     'estimateValue':x.estimateValue,\n                     'geoId':x.geoId,\n                     'marginAnnotation':x.marginAnnotation,\n                     'marginOfErrorValue':x.marginOfErrorValue,\n                     'variableCode':x.variableCode,\n                     'vintage':x.vintage\n                    })\n           )","user":"anonymous","dateUpdated":"2020-06-05T08:07:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344435633_-1370381313","id":"20200605-080715_1536189257","dateCreated":"2020-06-05T08:07:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:919","dateFinished":"2020-06-05T08:07:27+0000","dateStarted":"2020-06-05T08:07:27+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%spark.pyspark\nformattedata = df.rdd.map(lambda x:formatter(x))","user":"anonymous","dateUpdated":"2020-06-05T08:07:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344447591_-705650770","id":"20200605-080727_328263989","dateCreated":"2020-06-05T08:07:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1007","dateFinished":"2020-06-05T08:07:35+0000","dateStarted":"2020-06-05T08:07:35+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%spark.pyspark\nformattedata.take(1)","user":"anonymous","dateUpdated":"2020-06-05T08:07:44+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344455030_-581938381","id":"20200605-080735_187928323","dateCreated":"2020-06-05T08:07:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1079","dateFinished":"2020-06-05T08:07:46+0000","dateStarted":"2020-06-05T08:07:44+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[('00601-2018-B25119_001', '{\"id\": \"00601-2018-B25119_001\", \"zipCode\": \"00601\", \"variableCodeType\": \"001\", \"estimateAnnotation\": \"\", \"estimateValue\": 13092, \"geoId\": \"8600000US00601\", \"marginAnnotation\": \"\", \"marginOfErrorValue\": 1049, \"variableCode\": \"B25119_001\", \"vintage\": 2018}')]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-10-66-198-209.ec2.internal:4040/jobs/job?id=10"],"interpreterSettingId":"spark"}}},{"text":"%spark.pyspark\nformattedata.count()","user":"anonymous","dateUpdated":"2020-06-05T08:07:58+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344464331_-320500010","id":"20200605-080744_1380217371","dateCreated":"2020-06-05T08:07:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1151","dateFinished":"2020-06-05T08:08:09+0000","dateStarted":"2020-06-05T08:07:58+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"794880\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-10-66-198-209.ec2.internal:4040/jobs/job?id=11"],"interpreterSettingId":"spark"}}},{"text":"%spark.pyspark\nformattedata.saveAsNewAPIHadoopFile(\n\tpath='-',\n\toutputFormatClass=\"org.elasticsearch.hadoop.mr.EsOutputFormat\",\n\tkeyClass=\"org.apache.hadoop.io.NullWritable\",\n\tvalueClass=\"org.elasticsearch.hadoop.mr.LinkedMapWritable\",\n\tconf=es_write_conf_acs)\n","user":"anonymous","dateUpdated":"2020-06-05T08:08:41+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344478739_1013843912","id":"20200605-080758_851267334","dateCreated":"2020-06-05T08:07:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1264","dateFinished":"2020-06-05T08:09:49+0000","dateStarted":"2020-06-05T08:08:41+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-10-66-198-209.ec2.internal:4040/jobs/job?id=12","http://ip-10-66-198-209.ec2.internal:4040/jobs/job?id=13"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1591344511219_-1151795972","id":"20200605-080831_212956964","dateCreated":"2020-06-05T08:08:31+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1379"}],"name":"acs_pyxis","id":"2FC7BF217","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}